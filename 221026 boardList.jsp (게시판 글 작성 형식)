<%@ page language="java" contentType="text/html; charset=UTF-8"
    pageEncoding="UTF-8"   import="java.util.*"%>


<!--JSP 페이지에서 사용할 [사용자 정의 태그]의 한 종류인 [JSTL의 C 코어 태그]를 사용하겠다고 선언-->
<%@taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>


    
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">



<!-- JQuery 라이브러리 수입하기 -->
<script src = "/js/jquery-1.11.0.min.js"></script>
<script>
		// body 태그를 모두 읽어들인 후 실행할 자스 코딩 설정하기
		$(function(){
			// 새글 쓰기 버튼을 클릭하면 웹서버에 "/boardRegForm.do"
		 $(".newRegBtn").bind("click",function(){
				// location.replace("/boardRegForm.do" );				
		 
				
				// name=boardRegForm 을 가진 form 태그의 action 값 설정하기
				document.boardRegForm.action="/boardRegForm.do" ;

				// name=boardRegForm 을 가진 form 태그의 method 값 설정하기
				document.boardRegForm.method="post" ;
				
				// name=boardRegForm 을 가진 form 태그의 action 값 해당한 URL 주소로 웹서버 접속하기
		 		document.boardRegForm.submit();
				
				
		
		 	})
		 
		 /// 검색화면에 있는 검색 조건에 있는 것들이 들어가야하니까 post 방식을 사용해야함.
				
		 /// 검색화면에 있는 검색 조건에 있는 것		
		var formObj = $(".boardSearchForm");
			
		formObj.find(".keyword1").val("${param.keyword1}");
		
		
		<c:if test="${!empty param.or_And}">										/// 비어있지 않을 때만 파라미터 값을 넣어줘~ 라는 의미
			formObj.find(".or_And").val("${param.or_And}");		 		///  select  의 경우 로그인해서 들어갔을 때는 ($){param.or_And} 의 값이 없음. 결국 길이가 없는 select를 선택하게 됨. (디폴트로 or 가 선택될 수 있게 c코어 태그로 EL 만들어주기)
		</c:if>
			
		<c:if test="${!empty param.rowCntPerPage}">										
			formObj.find(".rowCntPerPage").val("${param.rowCntPerPage}");		 		
		</c:if>
	
		
		formObj.find(".keyword2").val("${param.keyword2}");	
		
		})

	function goBoardDetailForm( b_no  ){			/// 클릭한 게시판 행의 고유번호가 매개변수로 들어옴.
			
			// location.replace("/BoardDetailForm.do" );			/// 게시판의 상세보기 화면으로 가는 코드   
			// get 방식을 사용하면 location.replace("/BoardDetailForm.do?b_no="+b_no ); 를 해야함. (form 태그 안만들어도 되는 장점이 있음, 대신 pk 값을 url 주소 뒤에 같이 보내게 됨.)
		
			$("[name='boardDetailForm'] [name='b_no']").val(b_no);		/// hidden 태그는 화면에 출력되지 않는다는 보안성이 있어서 신경써야함.
			
			document.boardDetailForm.submit();
			 
		
		}
		
	// 검색 버튼 클릭했을 때 호출되는 함수 선언
	function boardSearch( ){					/// 검색버튼 누르자마자 작동됨.
		
		//--------------------------------------------------------
		// 입력한 키워드 가져와서 변수 keyword1에 저장하기				///  공백이 있는 경우의 유효성 체크를 해줘야함.
		var keyword1= $(".keyword1").val();
	
		// keyword1 변수 안에 문자가 아닌 데이터가 있으면 길이가 없는 문자로 대체하기
		if( typeof(keyword1)!="string" ){	keyword1=""; }					/// 문자가 아닌 경우.. 거의 undefined 일 경우가 많기 때문에 길이 없는 문자데이터 취급하기
		
		// keyword1 변수 안에 문자 앞뒤 공백 제거
		keyword1 = $.trim(keyword1);									/// 	따라서 크로스브라우징 가능한 코딩 사용하는 게 좋음 (JQuery의 장점.. 크로스 브라우징 가능케함.)	
		// 위 코드는 keyword1 = keyword1.trim(); 으로 대체 가능. <주의> String 객체의 메소드는 explorer9 이하의 버전에선 작동  X.  	
		
		// 웹화면 키워드 입력란에 앞뒤 공백 제거한 문자 삽입하기		/// 유저가 실수로 넣은 공백을 프로그램상 컷 해줄 수 있음.
		$(".keyword1").val(keyword1);		
		//--------------------------------------------------------


		
		// name=boardSearchForm 을 가진 form 태그의 action 값 해당한 URL 주소로 웹서버 접속하기		(method="post" action="/boardList.do" + 입력양식 등)
		// 이 때 form 태그 내부의 모든 입력양식의 
		// name 값은 파라미터명, value 값은 파라미터값으로 웹서버로 전송된다.	
		
		document.boardSearchForm.submit( );		/// 웹서버에 URL 주소를 명령하는 입력어 
		
		
		//--------------------------------------------------------
		// 입력한 키워드 가져와서 변수 keyword2에 저장하기	
		var keyword2=$(".keyword2").val();
		
		// keyword2 변수 안에 문자가 아닌 데이터가 있으면 길이가 없는 문자로 대체하기
		if( typeof(keyword2)!="string" ){	keyword2=""; }	
		
		// keyword2 변수 안에 문자 앞뒤 공백 제거
		keyword2 = $.trim(keyword2);	
		
		// 웹화면 키워드 입력란에 앞뒤 공백 제거한 문자 삽입하기
		$(".keyword2").val(keyword2);	
		// 위 코드는 keyword2 = keyword2.trim(); 으로 대체 가능. <주의> String 객체의 메소드는 explorer9 이하의 버전에선 작동  X.  	
		//--------------------------------------------------------

		
		
		
		//--------------------------------------------------------
		// name=boardSearchForm 을 가진 form 태그의 action 값 해당한 URL 주소로 웹서버 접속하기		(method="post" action="/boardList.do" + 입력양식 등)
		// 이 때 form 태그 내부의 모든 입력양식의 
		// name 값은 파라미터명, value 값은 파라미터값으로 웹서버로 전송된다.	
		//--------------------------------------------------------
		document.boardSearchForm.submit( );								/// 웹서버에 URL 주소를 명령하는 입력어  					
		
	}
		
	}
	
	// 모두 검색 버튼 클릭했을 때 호출되는 함수 선언

	function boardSearchAll( ){			/// 모두검색   (키워드를 비우고 들어간다고...?)
		
		// 웹화면 키워드1 입력란에 "" 삽입하기	
		$(".keyword1").val("");
		
		// 웹화면 키워드2 입력란에 "" 삽입하기	
		$(".keyword2").val("");
	

		$(".or_And").val("or");	
		
		// class=boardSearchBtn 가진 태그에 클릭이벤트 발생 시키기	
		$(".boardSearchBtn").click();

		
		// class=boardSearchBtn 가진 태그에 클릭이벤트 발생 시키기	
		$(".boardSearchBtn").click();	/// 모두 검색이라는 것 도 결국 검색버튼을 이용하는 것.
		// 위 코드는 오른쪽 코드로 대체가 가능하다.    document.boardSearchForm.submit( );							/// div 태그를 달아주고 3초뒤에 사라지게 한다.고..? animation fadeout 같은 기교 추가 가능...?

		
		}	
		
	
	
	//**********************************************
	// 함수 pageNoBtn 선언
	//**********************************************	
	function pageNoBtn( pageNo){				
		
		// class=selectPageNo 를 가진 입력양식에 
		// 클릭한 (= 선택한) 페이지 번호를 value 값으로 삽입하기( 서버로 선택한 페이지 번호를 보내기 위해 )	
		$(".selectPageNo").val( pageNo );	
	
	

		// boardSearch( ) 함수  호출하기
		boardSearch( );		/// 페이지 번호 누른 것 = 검색한 것과 마찬가지 (= 함수 boardSearch( ) 실행시켜야함.)
	
	}
	
		
		
</script>

</head>
<body>

	<!-- ************************************************************************ -->
	<!--  [게시판 검색 조건 입력 양식] 내포함 form 태그 선언 -->
	<!-- ************************************************************************ -->
	<form name="boardSearchForm" method="post" action="/boardList.do" class="boardSearchForm">		<!--  검색 조건을 가지고 다시 한 번 웹서버에 접속해서 검색화면을 보고싶은 것 (동기방식) -->
	
			<!-- -------------------------------------------- -->			<!--  화면이 깜빡이며 새로운 결과를 보일 경우 = 동기방식. 만약 비동기방식 사용한다면 자스코딩이 많아지지만 간단해진다는 장점이 있음 -->
			<!-- 키워드 데이터 저장할 입력양식 선언-->
			<!-- -------------------------------------------- -->
			[키워드]: 
			<!-- value 에 써넣은 EL태그처럼 파라미터값을 꺼내서 jsp 페이지에 넣으면 키워드가 남는다. -->
	<!-- 
			<input type="text" name="keyword1" class="keyword1" value="${param.keyword1}">			
			
			<select name="or_And">
				<option value="or"  ${ param.or_And=='or'?'selected':''} >or
				<option value="and" ${ param.or_And=='and'?'selected':''}>and
			</select>
			
			 <input type="text" name="keyword2" class="keyword2" value="${param.keyword2}">			
	 -->	
			 <!--  BoardSearchDTO 객체 넣고 바로 mapper_board  로 가면 됨. BoardController 로 갈 필요  X -->
				
				
				
			<input type="text" name="keyword1" class="keyword1" value="">	
			
			<select name="or_And" class="or_And">
				<option value="or"  >or
				<option value="and" >and
			</select>
			
			 <input type="text" name="keyword2" class="keyword2" value="">			
				
			<!-- ------------------------------------------------------------------------------ -->
			<!--  클릭한 페이지번호를 저장할 hidden 입력양식 선언. 페이징 처리 관련 데이터이다. -->
			<!-- ------------------------------------------------------------------------------ -->
			 <input type="hidden" name="selectPageNo" class="selectPageNo" value="1">
			 
			 <!-- ------------------------------------------------------------------------------ -->
			<!--  한 화면에서 보여지는 행의 개수를 저장할 hidden 태그 선언. -->
			<!-- ------------------------------------------------------------------------------ -->
			<input type="hidden" name="rowCntPerPage" class="rowCntPerPage" value="10">				<!-- 한 페이지 당 나와야할 페이지 번호,  출력 행의 개수 필요. -->
			 			
			<!-- ------------------------------------------------------------------------------ -->
			<!--  한 화면에서 보여지는 페이지 번호의 개수를 저장할 hidden 태그 선언. -->
			<!-- ------------------------------------------------------------------------------ -->
			<input type="hidden" name="pageNoCntperPage" class="pageNoCntperPage" value="10">	

			 <div style="height:10px">	  </div>
			  	<input type="button" value=" 검색 " class="boardSearchBtn" onClick="boardSearch()">&nbsp;			<!-- 검색 조건에 맞게 나오면 부모글과 자식글을 구분하기 어렵다는 단점이 있음 -->
			  	<input type="button" value=" 모두검색 " class="boardSearchAllBtn" onClick="boardSearchAll()">&nbsp;
			 <div style="height:10px">	  </div>
	</form>





	<table border=1 cellpadding=5 style="border-collapse:collapse">
		
	<tr bgcolor="skyblue">
		<th> 번호 </th>  <th> 제목 </th>  <th> 작성자 </th>   <th> 조회수 </th>  <th> 등록일 </th>
		
			
		
		<%
		
		
		/*
		<% 를 쓰면 이 안에서는 자바 코딩을 사용할 수 있다. 
		 HttpServletRequest 객체의 저장된 게시판 목록을 꺼내서 출력하기
		 
		 List<Map<String, String>> boardList = (  List<Map<String, String>> ) request.getAttribute( "boardList" );			/// HashMap 과 ArrayList의 수입 코딩이 없을 땐 JSP 페이지에서 클래스를 수입해주는 코딩을 적어야한다.
		 																		
		out.println( boardList.size() );	 																
		
		if( boardList!=null ){
			
			out.println("<caption> 총 개수 : " + boardList.size() + "개 </caption>");
			
      // 반복문이 실행되면서 DB에 있는 데이터(게시판 목록)를 각 HashMap 객체 넣는 코딩
			for (int i=0; i<boardList.size(); i++ ){				/// 자바니까 갯수 구하는 메소드가 size다!! length 가 아니다~~!!!
				
				Map<String, String> map = boardList.get(i);
				String b_no = map.get("b_no");
				String subject = map.get("subject");
				String writer = map.get("writer");
				String readcount = map.get("readcount");
				String reg_date = map.get("reg_date");
				
			/// 자바 코딩 중 if문으로 짝/홀수 줄마다 CSS 주는 방법 (가독성을 위해)
			//	if (i%2==1){
			//		out.println( "<tr bgcolor='lightgray'><td>"+ b_no +"<td>" + subject +"<td>" + writer +"<td>" + readcount +"<td>" + reg_date );	 
			//	}
			//	else {
			//		
			//		out.println( "<tr bgcolor='white'><td>"+ b_no +"<td>" + subject +"<td>" + writer +"<td>" + readcount +"<td>" + reg_date );	 
			//	}
			
			// 삼항연산자 사용해서 css 주는 법
				out.println( "<tr bgcolor='"+(i%2==1?"lightgray":"white")+"'><td  &nbsp;&nbsp;&nbsp;&nbsp;>"
			+ b_no +"&nbsp;&nbsp;&nbsp;&nbsp;<td>" + subject +"&nbsp;&nbsp;&nbsp;&nbsp;<td>"
			+ writer +"&nbsp;&nbsp;&nbsp;&nbsp;<td>" + readcount +"&nbsp;&nbsp;&nbsp;&nbsp;<td>" + reg_date );	
			}
		}
		
		
		*/
		%>
		<!-- {requestScope.boardList} 중 boardList는  BoardController의  boardList 와 같은 의미이다.      이 모든 EL, JSTL 코드는 내부적으로 결국 자바코드로 바뀐다.  -->
		<c:forEach var="board" items="${requestScope.boardList}" varStatus="loopTagStatus">   <!--  이 태그가 JSTL 태그. 그 중 c:forEach 가 자바코드 중 반복문임. -->
			<tr bgcolor="${loopTagStatus.index%2==1?'lightgray':'white'}">
			<td>${ board.b_no }			</td>		<!-- ($){} 형식으로 쓰는 것이 EL 태그.     (점).뒤에 HashMap 객체의 키값을 넣어준다. -->
			
			<td>
			
				<c:forEach begin="1" end="${ board.print_level }">		
					&nbsp;&nbsp;&nbsp;
				</c:forEach>				
				<c:if test="${ board.print_level>0 }">		
						ㄴ
				</c:if>
				
				${ board.subject }		
				
			</td>
			
			<td>${ board.writer }		</td>
			<td>${ board.readcount }	</td>
			<td>${ board.reg_date }		</td>   
			
	</c:forEach>
	</table>


<!-- 검색된 게시글의 개수가 0개보다 크면, 즉 검색된 게시물이 존재하면  			을 c 코어 태그로 표현함-->
	<c:if test="${requestScope.boardTotCnt>0 }" >			
	
		<!-- [처음] 문자 출력 -->
		<span style="cursor:pointer" onclick="pageNoBtn(1);">[처음]</span>
		
		<!-- [이전] 문자 출력 -->
		<span style="cursor:pointer" onclick="pageNoBtn( ${ requestScope.pagingMap.selectPageNo}-1 );">[이전]</span>				<!-- 이전페이지: 현재 선택한 페이지번호 -1 -->
	
		<!-- 선택한 페이지 번호에 대응하는 페이지 번호 출력 -->
		<c:forEach var="no" begin="${requestScope.pagingMap.begin_pageNo_perPage}" 
							end  ="${requestScope.pagingMap.end_pageNo_perPage}" step="1">		
		
			<!-- 만약에 선택한 페이지번호와 출력되는 페이지번호가 다르면-->
			<c:if test="${ requestScope.pagingMap.selectPageNo!=no}">		
				<span style="cursor:pointer"  onclick="pageNoBtn( ${no});"> [ ${no} ] </span> &nbsp; 			<!--  현재 페이지와 no 번호가 아닌 경우 괄호가 들어간다.  selectPageNo와 no -->
			</c:if>
			
			<!-- 만약에 선택한 페이지번호와 출력되는 페이지번호가 같으면-->
			<c:if test="${ requestScope.pagingMap.selectPageNo==no}">
				<span style="cursor:pointer" >	${no} </span> &nbsp; 
			</c:if>
		</c:forEach>	
	
		<!-- [다음] 문자 출력 -->
			<span style="cursor:pointer" onclick="pageNoBtn( ${ requestScope.pagingMap.selectPageNo}+1 );">[다음]</span>
		
		<!-- [마지막] 문자 출력 -->
		<span style="cursor:pointer" onclick="pageNoBtn( ${ requestScope.pagingMap.last_pageNo}    );">[마지막]</span>			<!--  가장 마지막 페이지 번호의 값을 가져와야한다. -->
	
		
	</c:if>
		
	
	<form name="boardRegForm" >   <!-- URL 주소인 action 값이 없어도 위에서 줄 수 있음. (document.boardRegForm.action="/boardRegForm.do"; 처럼) -->
	</form>
	

	<form name="boardDetailForm" method="post" action="/boardDetailForm.do">
		<input type="hidden" name="b_no"> 
	</form>

	

</body>
</html>
